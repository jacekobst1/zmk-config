#include <behaviors.dtsi>
#include <dt-bindings/zmk/bt.h>
#include <dt-bindings/zmk/keys.h>

#include "mouse.dtsi"
#include "combos.dtsi"

&lt {
    quick-tap-ms = <250>;
};

&sl {
    release-after-ms = <10000>;
    ignore-modifiers;
};

/ {
    conditional_layers { compatible = "zmk,conditional-layers"; };

    macros {
        ThickArrow: ThickArrow {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&kp SPACE &kp EQUAL &kp GT &kp SPACE>;
            label = "THICKARROW";
        };

        ThinArrow: ThinArrow {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            bindings = <&kp MINUS &kp GT>;
            label = "THINARROW";
        };

        Cmd1: Cmd1 {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            wait-ms = <30>;
            tap-ms = <20>;
             bindings =
                 <&macro_press &kp LGUI>,
                 <&macro_tap &kp N1>,
                 <&macro_release &kp LGUI>;

            label = "CMD1";
        };

        Cmd2: Cmd2 {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            wait-ms = <30>;
            tap-ms = <20>;
             bindings =
                 <&macro_press &kp LGUI>,
                 <&macro_tap &kp N2>,
                 <&macro_release &kp LGUI>;

            label = "CMD2";
        };

        Cmd3: Cmd3 {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            wait-ms = <30>;
            tap-ms = <20>;
             bindings =
                 <&macro_press &kp LGUI>,
                 <&macro_tap &kp N3>,
                 <&macro_release &kp LGUI>;

            label = "CMD3";
        };

        Cmd4: Cmd4 {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            wait-ms = <30>;
            tap-ms = <20>;
             bindings =
                 <&macro_press &kp LGUI>,
                 <&macro_tap &kp N4>,
                 <&macro_release &kp LGUI>;

            label = "CMD4";
        };

        Cmd5: Cmd5 {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            wait-ms = <30>;
            tap-ms = <20>;
             bindings =
                 <&macro_press &kp LGUI>,
                 <&macro_tap &kp N5>,
                 <&macro_release &kp LGUI>;

            label = "CMD5";
        };

        Cmd6: Cmd6 {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            wait-ms = <30>;
            tap-ms = <20>;
             bindings =
                 <&macro_press &kp LGUI>,
                 <&macro_tap &kp N6>,
                 <&macro_release &kp LGUI>;

            label = "CMD6";
        };

        Cmd7: Cmd7 {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            wait-ms = <30>;
            tap-ms = <20>;
             bindings =
                 <&macro_press &kp LGUI>,
                 <&macro_tap &kp N7>,
                 <&macro_release &kp LGUI>;

            label = "CMD7";
        };

        Cmd8: Cmd8 {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            wait-ms = <30>;
            tap-ms = <20>;
             bindings =
                 <&macro_press &kp LGUI>,
                 <&macro_tap &kp N8>,
                 <&macro_release &kp LGUI>;

            label = "CMD8";
        };

        Cmd9: Cmd9 {
            compatible = "zmk,behavior-macro";
            #binding-cells = <0>;
            wait-ms = <30>;
            tap-ms = <20>;
             bindings =
                 <&macro_press &kp LGUI>,
                 <&macro_tap &kp N9>,
                 <&macro_release &kp LGUI>;

            label = "CMD9";
        };
    };

    behaviors {
        hrml_ht: hrm_left_ht {
            compatible = "zmk,behavior-hold-tap";
            label = "Home row mods left hold tap";
            bindings = <&kp>, <&kp>;

            #binding-cells = <2>;
            tapping-term-ms = <160>;
            quick-tap-ms = <150>;
            require-prior-idle-ms = <80>;
            flavor = "balanced";
            hold-trigger-on-release;
            hold-trigger-key-positions = <RT0 RT1 RT2 RT3 RT4 RM0 RM1 RM2 RM3 RM4 RB0 RB1 RB2 RB3 RB4 LH1 LH0 RH0 RH1>;
            hold-while-undecided;
        };

        hrmr_ht: hrm_right_ht {
            compatible = "zmk,behavior-hold-tap";
            label = "Home row mods right hold tap";
            bindings = <&kp>, <&kp>;

            #binding-cells = <2>;
            tapping-term-ms = <160>;
            quick-tap-ms = <150>;
            require-prior-idle-ms = <80>;
            flavor = "balanced";
            hold-trigger-on-release;
            hold-trigger-key-positions = <LT4 LT3 LT2 LT1 LT0 LM4 LM3 LM2 LM1 LM0 LB4 LB3 LB2 LB1 LB0 LH1 LH0 RH0 RH1>;
            hold-while-undecided;
        };

        an_ht: appnav_ht {
            compatible = "zmk,behavior-hold-tap";
            label = "AppNavigation hold tap";
            bindings = <&kp>, <&kp>;

            #binding-cells = <2>;
            tapping-term-ms = <160>;
            flavor = "tap-preferred";
        };

        macro_ht1: macro_hold_tap1 {
            compatible = "zmk,behavior-hold-tap";
            label = "Macro hold tap 1";
            bindings = <&kp>, <&Cmd1>;

            #binding-cells = <2>;
            tapping-term-ms = <160>;
            flavor = "tap-preferred";
        };

        macro_ht2: macro_hold_tap2 {
            compatible = "zmk,behavior-hold-tap";
            label = "Macro hold tap 2";
            bindings = <&kp>, <&Cmd2>;

            #binding-cells = <2>;
            tapping-term-ms = <160>;
            flavor = "tap-preferred";
        };

        macro_ht3: macro_hold_tap3 {
            compatible = "zmk,behavior-hold-tap";
            label = "Macro hold tap 3";
            bindings = <&kp>, <&Cmd3>;

            #binding-cells = <2>;
            tapping-term-ms = <160>;
            flavor = "tap-preferred";
        };

        macro_ht4: macro_hold_tap4 {
            compatible = "zmk,behavior-hold-tap";
            label = "Macro hold tap 4";
            bindings = <&kp>, <&Cmd4>;

            #binding-cells = <2>;
            tapping-term-ms = <160>;
            flavor = "tap-preferred";
        };

        macro_ht5: macro_hold_tap5 {
            compatible = "zmk,behavior-hold-tap";
            label = "Macro hold tap 5";
            bindings = <&kp>, <&Cmd5>;

            #binding-cells = <2>;
            tapping-term-ms = <160>;
            flavor = "tap-preferred";
        };

        macro_ht6: macro_hold_tap6 {
            compatible = "zmk,behavior-hold-tap";
            label = "Macro hold tap 6";
            bindings = <&kp>, <&Cmd6>;

            #binding-cells = <2>;
            tapping-term-ms = <160>;
            flavor = "tap-preferred";
        };

        macro_ht7: macro_hold_tap7 {
            compatible = "zmk,behavior-hold-tap";
            label = "Macro hold tap 7";
            bindings = <&kp>, <&Cmd7>;

            #binding-cells = <2>;
            tapping-term-ms = <160>;
            flavor = "tap-preferred";
        };

        macro_ht8: macro_hold_tap8 {
            compatible = "zmk,behavior-hold-tap";
            label = "Macro hold tap 8";
            bindings = <&kp>, <&Cmd8>;

            #binding-cells = <2>;
            tapping-term-ms = <160>;
            flavor = "tap-preferred";
        };

        macro_ht9: macro_hold_tap9 {
            compatible = "zmk,behavior-hold-tap";
            label = "Macro hold tap 9";
            bindings = <&kp>, <&Cmd9>;

            #binding-cells = <2>;
            tapping-term-ms = <160>;
            flavor = "tap-preferred";
        };
    };

    keymap {
        compatible = "zmk,keymap";

        Base {
            bindings = <
&kp Q             &kp W            &kp E             &kp R              &kp T        &kp Y        &kp U             &kp I             &kp O            &kp P
&hrml_ht LCTRL A  &hrml_ht LALT S  &hrml_ht LMETA D  &hrml_ht LSHIFT F  &kp G        &kp H        &hrmr_ht LSHFT J  &hrmr_ht LMETA K  &hrmr_ht LALT L  &hrmr_ht LCTRL SEMI
&kp Z             &kp X            &kp C             &kp V              &kp B        &kp N        &kp M             &kp COMMA         &kp DOT          &kp SLASH
                                                     &lt 2 SPACE        &lt 4 TAB    &lt 3 ENTER  &lt 1 BACKSPACE
            >;
        };

        Num {
            bindings = <
&kp LBKT   &kp N7  &kp N8  &kp N9  &kp RBKT     &none  &ThickArrow  &none     &ThinArrow  &none
&kp SQT    &kp N4  &kp N5  &kp N6  &kp EQUAL    &none  &kp LSHFT    &kp LGUI  &kp LALT    &kp LCTRL
&kp GRAVE  &kp N1  &kp N2  &kp N3  &kp BSLH     &none  &none        &trans    &trans      &trans
                           &kp N0  &kp MINUS    &none  &trans
            >;
        };

        Nav {
            bindings = <
&none      &none      &none      &none       &none        &none      &kp CAPSLOCK   &caps_word  &kp INS    &none
&kp LCTRL  &kp LALT   &kp LMETA  &kp LSHIFT  &none        &none      &kp LEFT       &kp DOWN    &kp UP     &kp RIGHT
&kp LG(Z)  &kp LG(X)  &kp LG(C)  &kp LG(V)   &kp LG(B)    &none      &kp LG(LEFT)   &kp PG_DN   &kp PG_UP  &kp LG(RIGHT)
                                 &trans      &none        &kp ENTER  &kp BACKSPACE
            >;
        };

        LMs+Med {
            bindings = <
&none  &kp LG(LEFT_BRACKET)  &mmv MOVE_UP    &kp LG(RIGHT_BRACKET)  &msc SCRL_UP      &none             &none        &none         &none         &none
&none  &mmv MOVE_LEFT        &mmv MOVE_DOWN  &mmv MOVE_RIGHT        &msc SCRL_DOWN    &kp C_MUTE        &kp LSHFT    &kp LGUI      &kp LALT      &kp LCTRL
&none  &none                 &none           &none                  &mkp MCLK         &kp C_PLAY_PAUSE  &kp C_PREV   &kp C_VOL_DN  &kp C_VOL_UP  &kp C_NEXT
                                             &mkp LCLK              &mkp RCLK         &trans            &bootloader
            >;
        };

        AppNav {
            bindings = <
&none          &macro_ht7 LC(N7) 0               &macro_ht8 LC(N8) 0   &macro_ht9 LC(N9) 0   &none         &none      &none             &none         &none         &none
&none          &macro_ht4 LC(N4) 0               &macro_ht5 LC(N5) 0   &macro_ht6 LC(N6) 0   &none         &none      &kp LS(LG(LBKT))  &kp LG(LBKT)  &kp LG(RBKT)  &kp LS(LG(RBKT))
&kp LG(GRAVE)  &macro_ht1 LC(NUMBER_1) 0         &macro_ht2 LC(N2) 0   &macro_ht3 LC(N3) 0   &sk LSHIFT    &none      &none             &none         &none         &none
                                                                       &bootloader           &trans        &kp ENTER  &kp BACKSPACE
            >;
        };

        Fun {
            bindings = <
&kp F12  &kp F7  &kp F8  &kp F9  &none    &none           &none         &none         &none         &none
&kp F11  &kp F4  &kp F5  &kp F6  &none    &none           &kp LSHFT     &kp LGUI      &kp LALT      &kp LCTRL
&kp F10  &kp F1  &kp F2  &kp F3  &none    &none           &bt BT_SEL 0  &bt BT_SEL 1  &bt BT_SEL 2  &none
                         &none   &none    &bt BT_CLR_ALL  &none
            >;
        };

        RMs {
            bindings = <
&none  &none  &none  &none  &none    &msc SCRL_UP    &kp LG(LEFT_BRACKET)  &mmv MOVE_UP    &kp LG(RIGHT_BRACKET)  &none
&none  &none  &none  &none  &none    &msc SCRL_DOWN  &mmv MOVE_LEFT        &mmv MOVE_DOWN  &mmv MOVE_RIGHT        &none
&none  &none  &none  &none  &none    &mkp MCLK       &none                 &none           &none                  &none
                     &none  &none    &mkp LCLK       &mkp RCLK
            >;
        };
    };
};
